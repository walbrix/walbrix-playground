#require gentoo.lst

## emerge necessary components
#copy oscar/build.sh /build.sh
#chrootexec sh /build.sh && rm /build.sh

## system setup
#sed /etc/conf.d/hostname s/^hostname=.*$/hostname="oscar-dev"/
#chrootexec useradd -m oscar
#chrootexec groupmems -g cron -a oscar
#chrootexec groupmems -g tomcat -a oscar
#chrootexec groupmems -g wheel -a oscar
#sed /etc/sudoers s/^# \(\%wheel ALL=(ALL) NOPASSWD: ALL\)$/\1/
#copy oscar/oscar.include /etc/apache2/vhosts.d/oscar.include
#patchsinglefile /etc/apache2/vhosts.d/00_default_vhost.conf oscar/00_default_vhost.conf.patch
#symlink /etc/runlevels/default/vixie-cron /etc/init.d/vixie-cron
#copy oscar/sysctl-groonga.conf /etc/sysctl.d/groonga.conf
#copy oscar/sysctl-oscar.conf /etc/sysctl.d/oscar.conf

## Samba
#copy oscar/smb.conf /etc/samba/smb.conf
#chrootexec chmod g+rwx /var/lib/samba/private
#chrootexec smbpasswd -an
#chrootexec chmod g+rw /var/lib/samba/private/passdb.tdb
#chrootexec chgrp -R oscar /var/lib/samba/private

## Apache
#sed /etc/conf.d/apache2 s/^\(APACHE2_OPTS=.*\)\"$/\1 -D WSGI"/
#symlink /etc/runlevels/default/apache2 /etc/init.d/apache2

## tomcat
#chrootexec /usr/share/tomcat-7/gentoo/tomcat-instance-manager.bash --create
#chrootexec chmod g+w /var/lib/tomcat-7/webapps
#copy oscar/server.xml /etc/tomcat-7/server.xml
#copy oscar/context.xml /etc/tomcat-7/context.xml
#sed /etc/conf.d/tomcat-7 s/^#TOMCAT_EXTRA_JARS=""/TOMCAT_EXTRA_JARS="commons-dbcp,commons-pool,jdbc-mysql"/
#symlink /etc/runlevels/default/tomcat-7 /etc/init.d/tomcat-7

## groonga
#chrootexec cd /root && wget http://packages.groonga.org/source/groonga/groonga-3.0.9.tar.gz && tar xvzf groonga-*.tar.gz && cd groonga-*/ && ./configure --prefix=/usr --localstatedir=/var && make && make install && cd .. && rm -rf groonga-*/
#chrootexec git clone https://github.com/groonga/groonga-normalizer-mysql.git && cd groonga-normalizer-mysql && ./autogen.sh && ./configure && make && make install

## mroonga
#chrootexec cd /root && tar zxvf /usr/portage/distfiles/mysql-5.5.32.tar.gz && git clone https://github.com/mroonga/mroonga.git && cd mroonga && ./autogen.sh && ./configure --with-mysql-source=/root/mysql-5.5.32 && make && make install

## oscar
#copy oscar/build-oscar.sh /build-oscar.sh
#chrootexec sh /build-oscar.sh && rm /build-oscar.sh
#copy oscar/oscar-watcher.init /etc/init.d/oscar-watcher
#chrootexec chmod 755 /etc/init.d/oscar-watcher
#symlink /etc/runlevels/default/oscar-watcher /etc/init.d/oscar-watcher
#copy oscar/crontab /var/spool/cron/crontabs/oscar
#chrootexec chown oscar.crontab /var/spool/cron/crontabs/oscar 

## mysql
#sed /etc/mysql/my.cnf s/^\(max_allowed_packet\s*=\).*/\1 64M/
#patchsinglefile /etc/init.d/mysql oscar/mysql.init.patch
#copy mysql/setup_mysql.sh /setup_mysql.sh
#copy oscar/setup_initial_database.sh /setup_initial_database.sh
#copy oscar/setup_mroonga.sql /setup_mroonga.sql
#chrootexec sh /setup_mysql.sh && sh /setup_initial_database.sh && rm /setup_mysql.sh /setup_initial_database.sh /setup_mroonga.sql
#symlink /etc/runlevels/default/mysql /etc/init.d/mysql
#chrootexec groonga /var/lib/mysql/oscar.mrn register normalizers/mysql

## clamav
#chrootexec freshclam --no-warnings
#sed /etc/conf.d/clamd s/^START_CLAMD=.\+/START_CLAMD=no/
#symlink /etc/runlevels/default/clamav /etc/init.d/clamav

